---
layout: post
title:  "アルゴリズム取引"
date:   2017-12-20
excerpt: "トレーダーへの説明のため作成"
project: true
tag:
- Trade
- Technology
comments: false
---

# アルゴリズム取引
## アルゴリズム取引とは
- 一定ロジックに合わせて（自動で）売買すること（絶対的な定義はない）
- HFTと組み合わせることで、1000分の１秒単位での売買可能（アルゴリズム高速取引）
- 20年以上前からあったが、コロケーションサービスの提供（東証取引所は2010年に「アローヘッド」導入）による、処理時間の短縮により実用可能化
- Deep Learningによる精度の向上


## 現状
- 世界の株式市場のうち70%以上がアルゴリズム取引で取引
	- 日本では、東証の売買代金の約40%をアルゴリズム高速取引が占める

- 証券会社・取引所・証券規制当局の誰もがアルゴリズム取引の全体像や、取引戦略等を十分に把握すること困難
- サーバーに、アルゴリズムが組み込まれ、自動的に執行されるから、注文内容をあらかじめ確認することが困難（証券会社によりチェック機能も実効性に限界がある）
- 取引所は、証券会社を飛び越えて、証券会社の顧客に直接調査権限等を行使することは認められていない
- 証券規制当局は、不正の疑いがある時以外、平時に直接アルゴリズム取引を行う者に対し、報告欲求を行う権限を有していない。
- FX市場では、なぜアルゴリズム取引の存在感が少ないのか？
	- 未だに、インターバンク市場の相対取引で行われている取引が多いから
	- 株式市場：セカンダリーマーケットが発達していて、CPが処理する
	- インターバンク市場では、人間同士の相対で取引を行う部分が多い。

 
## 規制
### 欧州：規制導入
2018年1月からアルゴリズム高速取引を行う投資家を登録制とし、実効的な体制整備・リスク管理義務や当局に対する通知・情報提供義務）を課すこととなった。
また、証券会社など既存の投資サービス会社と同様、欧州域内の拠点設置義務、経営管理体制の整備、財務要件等も課されることとなる。

### 米国：まだない。見込みはある。
CFTCが提案するレギュレーションAT（Regulation Automated Person、施行時期未定）により、先物市場において直接電子アクセスを利用してアルゴリズム取引を行うプロップファームに新たに登録義務を課し、
また欧州類似の体制整備・リスク管理義務や当局に対する情報提供義務を課す規制が導入される見込みである。

### 日本：まだない。見込みもなさそう？
2016年の金融審議会「市場ワーキング・グループ」にて、規制の方向性について示唆した。（登録制にして、必要な体制整備やリスク管理義務等を課した上で、その取引実態を当局が確認することを可能にする仕組みを整備すべき。取引システムの運営主体として、市場に最も近いところにいある取引所がアルゴリズム高速取引を行う客を調査できるようにすることが適当）

PTS（Proprietary Trading System、私設取引システム）が大きなシェアを占める欧米市場は、日本取引所に取引がほぼ集中している我が国の証券市場とマーケット構造が大きく異なるため、欧米の規制をそのまま我が国に導入すれば様々な矛盾や過大なコストを生み、ひいては我が国の健全な証券市場の発展を阻害しかねない。
とはいえ、各国であまりに規制に差異があると相対的に規制の弱い市場に悪意ある投資家が跋扈する結果にもつながりかねず、レベル・プレイング・フィールド（対等な競争環境）確保の観点からも、我が国における規制はある程度欧米市場におけるそれと統一感を持ったものである必要
 ((by 伊藤 見富法律事務所弁護士 ニューヨーク州弁護士 公認不正検査士 丹羽 大輔 氏)


・ただし規制の実装の動きは今の所ない？（by ZooOnline）
東証では、特に2015年9月のリニューアルによって、一定の基準を超えた注文に対して自動的に抑制するリミット機能や、通信異常時の自動注文取消機能といった、プログラムの暴走を抑制する機能が導入がされており、安定している。

・税法上では推進はしていない。
海外事業者が国内に高頻度取引を行う為のサーバーを設置した場合、現在は恒久的施設、所謂支店として扱われ課税されてしまう。
消費税上では対応が行われているが、税率が高い日本でサーバーが支店かの様に扱われてしまう現在の税務上の取り扱いは海外事業者から見ると魅力的とは言いがたい。
 
## 問題点
- ある瞬間の領域を超え始めると、動きの方向性に以上についていくことになり、その売買がかなり加速される（相場での不埒な動きが発生）
- 信頼性の薄いメディアの内容にも反応。それを利用しようとする記事も増加
- 市場の不公正性
アリゴリズム取引が相場操縦などの不公正取り引きに利用される可能性が指摘  
　ex) 2013年、 FCA(英)がHFTを利用した相場操縦を摘発。90万米ドル超の民事制裁金を課す内容の和解を行った。  
　　　2013年、米国商品先物取引委員会（CFTC）が、18種類の商品先物に係るHFTを利用したスプーフィングにつき、140万ドルの民事制裁金の支払いと140万ドルの不当利得吐出しを命じた  
　　　2014年、米国証券取引委員会（SEC）が米国ニューヨークを拠点とするHFT業者によるアルゴリズムを利用した終値関与形態の相場操縦につき、100万米ドルの罰金を課した。  
　　　（アルゴリズム高速取引の相場操縦事例として公表されたものではないが、我が国での関連事例として）2014年9月、証券取引等監視委員会がアルゴリズムをツールとして利用して見せ玉の発注等を行ったシンガポール在住の個人による長期国債先物に係る相場操縦につき33万円の課徴金勧告を行った事例　等   
- 市場の安定性に与える影響
ボラティリティを高めているのではないか？  
マーケットへの過剰反応  
アルゴリズム取引同士の連鎖反応  
プログラムエラーなど  
  
 
## 問題点に関する代表的な出来事

### 2015年12/12　「日銀会合、マネタリーベース増加方針を維持−80兆円」
12:50に発表  
12:51　出来高が急増  
13:05 大きく下落  
— 一見、15分で結局正しい相場に戻ったのだから、良いように見えるが、この短期間で取引を繰り返し利益を得た、アルゴリズム取引もあったため、やはり公平とは言えない？  

### 2010年5/6　NYダウ
数分間で1000ドル急落（取引時間帯で、過去最大の下げ幅）  
誰かがご発注し、その銘柄のデータが他に影響して、他の銘柄も売らなくては！  
となり、市場全体に大きな影響を与えたと推測されている。  
この事件を機に、「サーキット・ブレーカー」が導入。（相場が大きく変動した時、相場を安定させるための取り組み）  

## 利点、肯定派
### 流動性の提供
スプレッドが縮まり、一般投資家にも恩恵行っている。  
常に取引を行っている事で流動性が生まれ、投資家が取引をしたい時に相手がいないという状況が少なくなる。取引を行うチャンスがあるのだ。また不必要な株価の変動も抑制される為、適正な株価にて購入できる可能性が高い。誰もが売買できる市場を形成、マーケットメイクを行っているという意味において、高頻度取引は必ずしも悪であるとはいえない。  
・アルゴリズム取引のシェアは世界的に増加中で、一律に市場から排除するのは無理そう  
・現在、アルゴリズム取引は、明らかな相場のかく乱要因として認識されているが、10年後くらいには、ファンダメンタル要因やテクニカル要因といったチャート変動要因と比較するものとして、アルゴリズム要因という言葉が当たり前のようになるのではないか。  

## 歴史
・アルゴリズム取引自体は、20以上前から存在。  
しかし東証は、一度に大量の注文が発生した場合、発注できなかった。  
2005年には、システム障害によって半日近く取引できなかったことも。  
・2010年の東証のアローヘッド導入  
・PCの性能向上によって、一般人でも容易に参加可能になったこと（個人的な推測）  
加えて、  
・ウォール街の話  
HTFを手がけている「バーチュ・ファイナンシャル」という投資会社が2014年4月上場すべく、3月に後悔した資料上の数値で、５年間で1日しか損失を出さなかったことを発表。(1237勝1負)  
（このアルゴリズム「Flash Boys」の中身を調べようとしたが、『Flash Boys』という本を買わないと教えてくれなさそうなので断念）  

・Twitterの感情分析で、ダウ予測が　max87%の精度で成功という論文発表。  
（http://networkpaper.blogspot.jp/2012/04/twitter.html）  
2008年2月28日〜12月19日に取得されたツイートの感情分析をして、そのうちの「Calm」の毎日の変動度合いが、数日後のダウ平均とmax87%以上の相関があった。  
２０１６年のデータで同じようなことうやってみるも全然ダメ。  
（https://www.slideshare.net/saito_hirokazu/ss-66050613）  


 
## アルゴリズムの例
### 「前々日終値が、前日終値よりも高い場合、買い。低い場合は売りで入れる」（ドル/円）
条件分岐（if文）を使用  
結果：2016年のデータ：9.6倍  
　　　2017年のデータ：-3.1倍  
考察：2016年はトレンド相場だった（Brexit、トランプ相場）  
　　　2017年はレンジ相場だった  

### 「過去25日分の終値から「翌日終値 – 当日終値」を予測」
2007年　〜　2016年のドル/円の日足データを学習  
NN（ニューラルネットワーク）を使用  
結果：正答率：48%（ランダムでやると大体55%）  
　　　利益：0.24倍

### 「入力データに、テクニカル指標を使う」
5日、25日75日200日の移動平均線、  
過去9、26、52日間の一目均衡表、  
25日ボリンジャーバンドを追加。  
結果：2017年データ：正答率58%  

### もっと色々入れてみる（USD/JPY）
予測タイミング：毎分  
10分後の対象レートが現在の価格より上がるか下がるかを予測  
1分5分1時間、1日のローソク足  
ボリンジャーバンド  
一目均衡表  
RSI  
MACD  
ストキャスティクス  
DMI  
％R  
を使用  
結果：正答率55% - 62%  

### RNN（LSTM）でFXの予測
2011 – 2015年までの1時間足（EUR/USD）を使用  
詳しいやり方は書いてなかったが、LSTMを使ったということで、単なる入力データというより、時系列として扱ったと思われる。  
結果：正答率52%  

### テクストマイニング
（日本経済新聞「AI、50年は人に勝てぬ」）
word2vecとLSTMを使用。
具体的に、何のメディアを使用したのかや、予測精度の値は探しても出てこなかった。
テキストマイニングは主に、株価予測で使われているようだが、それでも、テキストマイニングを用いた株価予測に関する、具体的な予測精度の値などは探しても出てこなかった。

昔：「赤字」「決算」などの単語の出現頻度から文章のおおよその意味を読み取る
　　-> 精度低い
現在：単語を数値化して、単語同士の意味合いを理解。意味の計算可能。
　　　LSTMによって長文にも対応可能。
　　　複数の情報源を参照することで、虚偽ニュースの被害を抑える。
　　　指定の単語に反応して売買するモデルもある。
　　　ex) イギリスのEU離脱が騒がれていた時期は「離脱」というキーワードで売り、「残留」で買いが設定されていたらしい。
       日銀会合の時は、「介入」や「追加緩和」に反応するらしい。
結果：移動平均線などのチャート分析や、他の線形のパターン分析に比べて、推定精度を平均で48.2% - ｍax 72%改善。（具体的に精度がどれくらいなのかは探しても出てこない）
　　：突発的な、変動要因が起こり得る個別銘柄より、インデックスの方が予測しやすい
　　　株式市場で。指数の構成銘柄の変更が起こると、過去データとの相関が薄れてしまう。
　　：過去に似た原因で相場が動いた「経験則」がないと、予測困難
　　：ニュースはマーケットに対して後追いで反応している可能性
　　：小型株に対するニュース指標の影響が相対的に大きく長続きする
　　：誤検出まだまだ大きい

### その他
・SNS（Twitter）からの感情分析（＊歴史の方に記述）
・現在、証券会社では、顧客の中からトレードが上手な人を選んで、その人の取引のパターンをコピーすることもしている。

## 詳細な中身
### NN(ニューラルネットワーク)
 
一般的な機械学習の手法
隠れ層が3層以上のものをDeep Learningと呼ぶ。
従来は、最初に入力する特徴量を人間が選択してあげなくてはいけなかったが、現在ではまとめて「東証５００銘柄の過去1年間のデータ」をまとめて入れてあげることで、その中から自動で影響のある特徴量を１部選択してくれる。
時系列的な判断はできない

・RNN（リカレント・NN）　—　テキストマイニングするときに主に使用
 
ネットワーク内にループを持たせ、過去のデータを次回のデータの入力に利用
過去データと現在データを両方用いて予測
時系列的な判断が可能。
最初の頃の入力効果が弱まり、データ忘れちゃう
・LSTM（Long Short Term Memory）　—　RNNの進化版
 
forget gateを利用することで、最初の方の状態も忘れないでおく！
・（ちなみに）Word2vecter —　これによって意味の計算可能に。
 
単語ごとに、辞書に従って数値化する（ベクトル化）
その数字を見て、単語間の関係性とかがわかる。
　—対義語、男 <-> 女、首都とか。
翻訳、自動作文、チャットサービスに利用
 
## 限界と弱点
・過去に似た原因で相場が動いた「経験則」がないと、予測困難
・マーケットの挙動自体が変わるようなことが起きると、過去のデータが使えなくなってしまう
ex)リーマンショックなど。
・ある企業を判断する時、「競合は？」「マーケットは？」「社長の性格は？」といったものを総合的に性格に判断することはAIにはほぼ不可能（by 東大松尾教授）
・その企業の業務の内容や、社長の人間性、商品のデザインや、本当にこの商品が売れるのだろうか？みたいな判断はAIにはできない。
　-> そういったところに個人的に関心を持ち、その企業の株を中長期で保有することなどAIにはできない。短期で、利益で狙えるチャンスがないかチャート等のデータをずっと見張っていることしかできない。
・大きな事象を予測することはできない
　１ヶ月といった長期スパンをAIが予測することは困難（by 野村証券AI導入担当　原田大資さん）
　デイトレード、超短期（1000分の1秒）は得意だが。
ちなみに、原田さんの開発するアルゴリズム取引は5分後の株価を予測
・一定に達した瞬間（100円/ドル）爆買いが起き、その直後（110円/ドルになった瞬間）に急落したりする。
・ある時、誤発注によって想定外の相場になる
　—いくつかのアルゴリズムが反応し、大きな取引を始める
　　—他のアルゴリズムを刺激し、さらに取引を始める
　　　—暴落や、暴騰が起きる
・根拠のブラックボックス
・ファンダメンタル要因に弱い
・テキストマイニングでの誤差がまだある

・人間の強み
一般的な常識
他のトレーダーの心理を読む社会性
過去にない事例に柔軟に対応できる
・指標トレードにはできるだけ参加しない
・自分のスイングを中長期に変えて、仮に30pipsや50pipsでやりあっているようなアルゴリズム取引はノイズとみなす
・TAIGUN FLASHなどのサービスを使用
・儲かるか？どうかは微妙
精度もそうだし、そのアルゴリズムを他の人が何人使っているかとかでも大きく左右されてしまうから（by 松尾教授）
・投資判断としてのSuggestionとして利用するのがベストだろう。（by 松尾教授）
　ってことは、そのSuggestionの中から結局何を選びどのタイミングでそれだけ投資するか等を決めるのはその人の能力に依存？。
